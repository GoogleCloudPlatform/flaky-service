steps:
  #build
- id: 'Build Container Image'
  name: 'gcr.io/cloud-builders/gcloud'
  dir: 'packages/api'
  args: ['builds','submit', '--tag', 'gcr.io/oss-automation/api-staging']
options:
  env: [
    'FLAKY_DP_PROJECT=flaky-dev-development',
    'HEAD_COLLECTION='
  ]

  #deploy
- id: 'Deploy to Cloud Run'
  name: 'gcr.io/cloud-builders/gcloud'
  args: 
  - 'run'
  - 'deploy'
  - 'api-staging'
  - '--image'
  - 'gcr.io/oss-automation/api-staging'
  - '--region'
  - 'us-central1'
  - '--platform'
  - 'managed'
  - '--allow-unauthenticated'
substitutions:
  _FIREBASE_CLOUDRUN_PROJECT